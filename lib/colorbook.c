/*
 * colorbook.c
 *
 * playing with pigments
 *
 * Author: Zex <top_zlynch@yahoo.com>
 */
#include "colorbook.h"

/*
 *  0x00-0x07:  standard colors (as in ESC [ 30..37 m)
 *  0x08-0x0f:  high intensity colors (as in ESC [ 90..97 m)
 *  0x10-0xe7:  6*6*6=216 colors: 16 + 36*r + 6*g + b (0≤r,g,b≤5)
 *  0xe8-0xff:  grayscale from black to white in 24 steps
 */
char *col_prefix[] = {
"\033[0;31m",
"\033[0;32m",
"\033[0;33m",
"\033[0;34m",
"\033[0;35m",
"\033[0;36m",
"\033[0;37m",
"\033[0;38m",
"\033[1;31m",
"\033[1;32m",
"\033[1;33m",
"\033[1;34m",
"\033[1;35m",
"\033[1;36m",
"\033[1;37m",
"\033[1;38m",
/* 256 color mode */
//"\033[38;5;0m",
"\033[38;5;1m",
"\033[38;5;2m",
"\033[38;5;3m",
"\033[38;5;4m",
"\033[38;5;5m",
"\033[38;5;6m",
"\033[38;5;7m",
"\033[38;5;8m",
"\033[38;5;9m",
"\033[38;5;10m",
"\033[38;5;11m",
"\033[38;5;12m",
"\033[38;5;13m",
"\033[38;5;14m",
"\033[38;5;15m",
//"\033[38;5;16m",
"\033[38;5;17m",
"\033[38;5;18m",
"\033[38;5;19m",
"\033[38;5;20m",
"\033[38;5;21m",
"\033[38;5;22m",
"\033[38;5;23m",
"\033[38;5;24m",
"\033[38;5;25m",
"\033[38;5;26m",
"\033[38;5;27m",
"\033[38;5;28m",
"\033[38;5;29m",
"\033[38;5;30m",
"\033[38;5;31m",
"\033[38;5;32m",
"\033[38;5;33m",
"\033[38;5;34m",
"\033[38;5;35m",
"\033[38;5;36m",
"\033[38;5;37m",
"\033[38;5;38m",
"\033[38;5;39m",
"\033[38;5;40m",
"\033[38;5;41m",
"\033[38;5;42m",
"\033[38;5;43m",
"\033[38;5;44m",
"\033[38;5;45m",
"\033[38;5;46m",
"\033[38;5;47m",
"\033[38;5;48m",
"\033[38;5;49m",
"\033[38;5;50m",
"\033[38;5;51m",
"\033[38;5;52m",
"\033[38;5;53m",
"\033[38;5;54m",
"\033[38;5;55m",
"\033[38;5;56m",
"\033[38;5;57m",
"\033[38;5;58m",
"\033[38;5;59m",
"\033[38;5;60m",
"\033[38;5;61m",
"\033[38;5;62m",
"\033[38;5;63m",
"\033[38;5;64m",
"\033[38;5;65m",
"\033[38;5;66m",
"\033[38;5;67m",
"\033[38;5;68m",
"\033[38;5;69m",
"\033[38;5;70m",
"\033[38;5;71m",
"\033[38;5;72m",
"\033[38;5;73m",
"\033[38;5;74m",
"\033[38;5;75m",
"\033[38;5;76m",
"\033[38;5;77m",
"\033[38;5;78m",
"\033[38;5;79m",
"\033[38;5;80m",
"\033[38;5;81m",
"\033[38;5;82m",
"\033[38;5;83m",
"\033[38;5;84m",
"\033[38;5;85m",
"\033[38;5;86m",
"\033[38;5;87m",
"\033[38;5;88m",
"\033[38;5;89m",
"\033[38;5;90m",
"\033[38;5;91m",
"\033[38;5;92m",
"\033[38;5;93m",
"\033[38;5;94m",
"\033[38;5;95m",
"\033[38;5;96m",
"\033[38;5;97m",
"\033[38;5;98m",
"\033[38;5;99m",
"\033[38;5;100m",
"\033[38;5;101m",
"\033[38;5;102m",
"\033[38;5;103m",
"\033[38;5;104m",
"\033[38;5;105m",
"\033[38;5;106m",
"\033[38;5;107m",
"\033[38;5;108m",
"\033[38;5;109m",
"\033[38;5;110m",
"\033[38;5;110m",
"\033[38;5;111m",
"\033[38;5;112m",
"\033[38;5;113m",
"\033[38;5;114m",
"\033[38;5;115m",
"\033[38;5;116m",
"\033[38;5;117m",
"\033[38;5;118m",
"\033[38;5;119m",
"\033[38;5;120m",
"\033[38;5;121m",
"\033[38;5;122m",
"\033[38;5;123m",
"\033[38;5;124m",
"\033[38;5;125m",
"\033[38;5;126m",
"\033[38;5;127m",
"\033[38;5;128m",
"\033[38;5;129m",
"\033[38;5;130m",
"\033[38;5;131m",
"\033[38;5;132m",
"\033[38;5;133m",
"\033[38;5;134m",
"\033[38;5;135m",
"\033[38;5;136m",
"\033[38;5;137m",
"\033[38;5;138m",
"\033[38;5;139m",
"\033[38;5;140m",
"\033[38;5;141m",
"\033[38;5;142m",
"\033[38;5;143m",
"\033[38;5;144m",
"\033[38;5;145m",
"\033[38;5;146m",
"\033[38;5;147m",
"\033[38;5;148m",
"\033[38;5;149m",
"\033[38;5;150m",
"\033[38;5;151m",
"\033[38;5;152m",
"\033[38;5;153m",
"\033[38;5;154m",
"\033[38;5;155m",
"\033[38;5;156m",
"\033[38;5;157m",
"\033[38;5;158m",
"\033[38;5;159m",
"\033[38;5;160m",
"\033[38;5;161m",
"\033[38;5;162m",
"\033[38;5;163m",
"\033[38;5;164m",
"\033[38;5;165m",
"\033[38;5;166m",
"\033[38;5;167m",
"\033[38;5;168m",
"\033[38;5;169m",
0
};

char *col_surfix = "\033[0m";

float show_process_bar(process_bar *pb)
{
	size_t x;

	if (pb->cur > pb->max) return 0;
	if (!pb->left && (pb->left = "="));
	if (!pb->right && (pb->right = " "));

	pb->bar_width = 100;
	pb->bar_cur = pb->cur*pb->bar_width/(float)pb->max;

	printf("[");
	for (x = 0; x < (size_t)pb->bar_cur; x++) 
		printf("%s", (x+1) != (size_t)pb->bar_cur ? pb->left :
			pb->bar_width != (size_t)pb->bar_cur ? ">" : "\0");

	for (;x < pb->bar_width; x++) printf(pb->right);

	printf("] %.f%%\n\033[F", pb->bar_cur);

	return pb->bar_cur;
}

size_t color_chart_selftest()
{
	color_table col_tb = {
		.color_prefix = col_prefix,
		.color_surfix = "\033[0m",
		.usr_str = "colorful world",
		.full_size = strlen(col_tb.color_prefix[16])+strlen(col_tb.usr_str)+strlen(col_tb.color_surfix)-2,
		.text_buffer = (char*)malloc(col_tb.full_size),
		.color_table_size = 0
	};
	size_t x = 0;

	while (*(col_tb.color_prefix+x)) {
		printf("%s%u[%s]%s%s", (x<10?"00":x<100?"0":"\0"), x, 
			TEXT_WITH_COLOR(&col_tb, x),
			!((x+1) % 5)?"\n":"\0", (!*(col_tb.color_prefix+x+1))?"\n":"\0");
	}

	free(col_tb.text_buffer);

	return x;
}

int show_color_word()
{
	color_table col_tb = {
		.color_prefix = col_prefix,
		.color_surfix = "\033[0m",
		.usr_str = "colorful world",
		.full_size = strlen(col_tb.color_prefix[16])+strlen(col_tb.usr_str)+strlen(col_tb.color_surfix)-2,
		.text_buffer = (char*)malloc(col_tb.full_size),
		.color_table_size = color_chart_selftest()
	};
	process_bar pb = {
		.col_tb = col_tb,
		.max = col_tb.color_table_size,
		.left = 0,
		.right = 0,
	};
	size_t x = 0;

	while (1) {
		pb.cur = x;

		show_process_bar(&pb);

		if (!*(col_prefix+x)) {
			printf("\n");
			break;
		}

		printf("%s", TEXT_WITH_COLOR(&col_tb, x));
	//	sleep(1);
	}
	
	free(col_tb.text_buffer);
	return 0;
}


